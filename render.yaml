// ç®€å•çš„æœåŠ¡å™¨åŒ…è£…å™¨ï¼Œç”¨äº Zeabur éƒ¨ç½²
import http from 'http';
import { URL } from 'url';
import handler from './api/get.js';

const server = http.createServer(async (req, res) => {
  // è§£æ URL
  const url = new URL(req.url, `http://${req.headers.host}`);
  
  // åªå¤„ç† /api/get è·¯å¾„
  if (url.pathname === '/api/get') {
    // å°†æŸ¥è¯¢å‚æ•°è½¬æ¢ä¸ºå¯¹è±¡
    const query = {};
    for (const [key, value] of url.searchParams) {
      query[key] = value;
    }
    
    // åˆ›å»ºå…¼å®¹çš„è¯·æ±‚å¯¹è±¡
    const nodeReq = {
      method: req.method,
      query: query,
      url: req.url
    };
    
    // è°ƒç”¨ä½ çš„åŸå§‹å¤„ç†ç¨‹åº
    await handler(nodeReq, res);
  } else {
    // å¥åº·æ£€æŸ¥ç«¯ç‚¹
    res.writeHead(200, { 'Content-Type': 'application/json' });
    res.end(JSON.stringify({ 
      message: 'Lyric API Server is running',
      endpoint: '/api/get?track_name=æ­Œæ›²å&artist_name=æ­Œæ‰‹å'
    }));
  }
});

const port = process.env.PORT || 3000;
server.listen(port, () => {
  console.log(`ğŸš€ Server running on port ${port}`);
});